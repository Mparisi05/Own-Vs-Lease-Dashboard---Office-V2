<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner-User Analysis | Buy vs. Lease Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header-content {
            text-align: center;
        }

        .header-logo {
            position: absolute;
            top: 10px;
            right: 10px;
            height: 100px;
            width: auto;
        }

        .header-logo svg {
            height: 100%;
            width: auto;
        }

        @media (max-width: 768px) {
            .header {
                padding-top: 80px;
            }
            
            .header-logo {
                height: 70px;
                top: 8px;
                right: 8px;
            }
        }


        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
        }

        .input-panel {
            background: #f8f9fa;
            padding: 20px;
            border-right: 2px solid #e0e0e0;
            max-height: 100vh;
            overflow-y: auto;
            position: sticky;
            top: 0;
        }

        .results-panel {
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 0.9em;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            margin-bottom: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .checkbox-group label:hover {
            background-color: #f0f0f0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .scenario-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .scenario-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .scenario-card.low {
            border-color: #52c41a;
        }

        .scenario-card.average {
            border-color: #1890ff;
        }

        .scenario-card.high {
            border-color: #fa8c16;
        }

        .scenario-card h4 {
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }

        .scenario-card.low h4 {
            color: #52c41a;
            border-color: #52c41a;
        }

        .scenario-card.average h4 {
            color: #1890ff;
            border-color: #1890ff;
        }

        .scenario-card.high h4 {
            color: #fa8c16;
            border-color: #fa8c16;
        }

        .metric {
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #2c3e50;
        }

        .comparison-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .comparison-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .comparison-item {
            padding: 15px;
            border-radius: 8px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .comparison-item.current {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .comparison-item.ownership {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            color: white;
        }

        .comparison-item h4 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .comparison-item .amount {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .savings {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border-radius: 10px;
            margin-top: 20px;
        }

        .savings.negative {
            background: linear-gradient(135deg, #e57373 0%, #ef5350 100%);
        }

        .savings h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .savings .amount {
            font-size: 2.5em;
            font-weight: 700;
        }

        .purchasing-power {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .purchasing-power h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .power-metric {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .power-metric h4 {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .power-metric .value {
            font-size: 2.2em;
            font-weight: 700;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #1890ff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 0.9em;
        }

        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }

            .input-panel {
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
                max-height: none;
            }

            .scenario-cards {
                grid-template-columns: 1fr;
            }
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #666;
            font-size: 0.9em;
        }

        .detail-value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* Slider Styles */
        .slider-container {
            margin-bottom: 30px;
        }

        .slider-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .slider-header h4 {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .slider-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
        }

        .slider-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .slider-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .slider-btn:active {
            transform: scale(0.95);
        }

        .slider-track {
            flex: 1;
            position: relative;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
        }

        .slider-input {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #2c3e50;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .slider-input::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #2c3e50;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-top: 8px;
        }

        .slider-indicators {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .more-power {
            color: #28a745;
        }

        .less-power {
            color: #e57373;
        }

        .slider-description {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #555;
            line-height: 1.5;
            margin-top: 10px;
        }

        .dcr-slider .slider-btn { background: #9b59b6; }
        .dcr-slider .slider-btn:hover { background: #8e44ad; }
        
        .down-slider .slider-btn { background: #27ae60; }
        .down-slider .slider-btn:hover { background: #229954; }
        
        .rate-slider .slider-btn { background: #e67e22; }
        .rate-slider .slider-btn:hover { background: #d35400; }
        
        .term-slider .slider-btn { background: #9b59b6; }
        .term-slider .slider-btn:hover { background: #8e44ad; }

        /* Quality Selector Styles */
        .quality-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .quality-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .quality-btn {
            padding: 8px 16px;
            border: 2px solid #d0d0d0;
            background: white;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            white-space: nowrap;
        }

        .quality-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .quality-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }

        .quality-btn.active:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .comparison-section h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .comparison-section h3 .title-text {
            flex: 1;
            min-width: 250px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .header p {
                font-size: 0.9em;
            }

            .input-panel {
                padding: 20px;
            }

            .results-panel {
                padding: 20px;
            }

            .section {
                padding: 15px;
                margin-bottom: 20px;
            }

            .section h3 {
                font-size: 1em;
            }

            .input-group input,
            .input-group select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
            }

            .calculate-btn {
                padding: 15px;
                font-size: 1em;
            }

            /* Make scenario cards scroll horizontally on mobile */
            .scenario-cards {
                display: flex;
                overflow-x: auto;
                gap: 15px;
                padding-bottom: 10px;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }

            .scenario-card {
                min-width: 280px;
                flex-shrink: 0;
                scroll-snap-align: start;
            }

            .scenario-card h4 {
                font-size: 1.1em;
            }

            .metric-label {
                font-size: 0.85em;
            }

            .metric-value {
                font-size: 1em;
            }

            /* Comparison section */
            .comparison-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .comparison-item h4 {
                font-size: 1em;
            }

            .comparison-item .amount {
                font-size: 1.8em;
            }

            .quality-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .quality-btn {
                width: 100%;
                padding: 12px;
                font-size: 0.9em;
            }

            .comparison-section h3 {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .quality-selector {
                width: 100%;
                flex-direction: column;
            }

            .savings .amount {
                font-size: 1.8em;
            }

            .power-metric .value {
                font-size: 1.8em;
            }

            /* Slider adjustments */
            .slider-container {
                padding: 15px 10px;
            }

            .slider-value {
                font-size: 1.1em;
            }

            /* Market checkboxes */
            .checkbox-group label {
                font-size: 0.9em;
                padding: 10px 8px;
            }

            /* Make tables and large content scrollable */
            .comparison-section,
            .purchasing-power {
                overflow-x: auto;
            }

            /* Action buttons mobile */
            .action-buttons-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3em;
            }

            .scenario-card {
                min-width: 260px;
            }

            .comparison-item .amount {
                font-size: 1.5em;
            }

            .power-metric .value {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Owner-User Analysis</h1>
                <p>Should you buy or lease? Compare ownership costs vs. leasing based on Atlanta market data</p>
            </div>
            <div class="header-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 335.78 202.22">
                    <defs>
                        <style>
                            .logo-line { fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: .5px; }
                            .logo-dark { fill: #ffffff; }
                            .logo-blue { fill: #4da3ff; }
                        </style>
                    </defs>
                    <g>
                        <path class="logo-dark" d="M58.69,85.64c-.83-.55-.03-1.55.36-1.99l2.15-2.44c.31-.35,5.8-6.43,4.65-6.6-.37-.15-1.22-.03-1.68.15l-5.37,2.11c-3.06,1.2-5.89,2.92-8.5,4.92-.6.46-.78,1.34-1.49,1.73-.35.19-.12.88-.34,1.15-.31.38-1.31.99-1.83.76-1-.43-.59-1.93.13-2.57,2.93-2.6,6.2-4.49,9.7-6.33,2.91-1.53,6.02-2.5,9.17-3.43.53-.15,1.28.13,1.52.4,1.1,1.25-1.17,4-2.11,5.12l-3.05,3.62c.57.39.75-.16,1.08-.33,2.29-1.2,4.3-2.68,6.52-4.02,2.44-1.47,4.84-2.82,7.38-4.13.41-.21.8.54,1.11.72l-3.9,5.1c-1.6,2.09-3.27,4.06-4.51,6.46.7.36,1.25-.13,1.83-.49l9.27-5.79c1.22-.76,2.35-1.49,3.58-2.22l8.42-5.02c.94-.56,5.72-3.9,5.82-3.91.38-.02,1.14.05,1.28.63s-.5,1.15-.95,1.41l-6.85,3.96c-4.15,2.4-7.61,5.57-10.76,9.24l-.76.89c-2.13,2.48-3.74,5.33-5.24,8.24-.86,1.66-1.29,3.68-.85,5.45s1.81,2.98,3.14,3.91c3.7,2.58,11.61,2.72,16.09,1.84,4.72-.93,9.25-2.4,13.7-4.15.24-.09.31.31.31.44,0,.27-.2.43-.5.57l-3.28,1.51c-7.77,3.58-26.53,6.48-30.62-3.36-.75-1.8-.27-4.16.53-5.95,1.73-3.83,4.12-7.2,6.62-10.52.64-.85,1.7-1.24,2-2.48l-10.72,6.65c-.75.47-2.25,1.24-2.97.5-.82-.84-.1-2.54.52-3.37l4.39-5.96c.38-.52,1.21-.85.97-1.69-2.38,1.35-4.53,2.54-6.64,3.92l-7.29,4.75c-.46.3-1.53.92-2.03.58Z"/>
                        <path class="logo-dark" d="M86.33,92.49c-.57-1.86,3.08-3.62,4.32-4.38,1.4-.87,6.37-3,7.1,0,1.21-.56,1.58-1.86,2.34-1.81.24.02.72.34.68.67-.21,1.51-3.65,3.75-3.99,6.05,2.33-.3,4.25-1.4,6.21-2.35l4.22-2.06c3.14-1.53,6.14-3.15,8.94-5.25.33-.25.71-.57,1.04-.63s1.21.31.94.76c-1.64,2.71-5.49,2.92-8.72,7.28-.37.5-.85,1.01-.36,1.72l5.65-3.14c3.3-1.83,6.38-3.86,9.02-6.59.28-.29.66-.55,1.02-.35.99.54-.92,2.6-1.52,3.23-2.91,3.06-1.33,4.51-2.03,4.98-.25.16-.82.6-1.07.28-.37-.47-.61-.92-.99-1.33.71-.58,1.23-1.41,1.16-2.34-3.57,2.43-6.95,4.56-10.65,6.34-.57.28-1.3.2-1.73-.06-.57-.34-.58-1.08-.53-1.8.07-.93.95-1.26,1.28-2.37l-9.16,4.37c-.7.34-3.08,1.03-3.92.19-.74-.73.61-2.4.32-3.12-1.82.87-8.64,4.74-9.57,1.7ZM95.81,89.03c-1.39-.79-7.47,1.02-8.05,2.89.7,1.22,7.67-1.97,8.05-2.89Z"/>
                        <path class="logo-dark" d="M110.25,80.64c-1.56.22-2.98,0-4.3.56l-3.02,1.29c-.65.28-1.51-1.18-1.2-1.75.37-.69,1.29-.09,1.75-.31,1.5-.72,2.93-.51,4.47-.74l12.05-1.81,5.16-.68c2.61-.34,5.14-.53,7.77-.75l4.73-.39,12.26-.56c6.09-.28,12.04.17,18.2,1.19-2.96,1.06-5.74.23-8.59.19-4.44-.07-8.75-.27-13.15.01l-8.94.57c-1.8.11-3.5.27-5.28.43l-5.57.48-5.33.72-11.01,1.55Z"/>
                    </g>
                    <g>
                        <path class="logo-dark" d="M106.97,122.77l-1.86.04-3.53-3.65-3.46.03-.02,3.58c-.5.09-.98.08-1.56.01v-10s6.18-.02,6.18-.02c1.08,0,2.08.41,2.95.99.73.57,1,1.4.98,2.3-.05,2.01-1.5,2.56-3.23,3.05l3.55,3.66ZM105.08,115.88c-.11-1.87-2.26-1.93-3.74-1.92l-3.23.04.04,3.95h4.15c1.42-.02,2.88-.54,2.79-2.07Z"/>
                        <path class="logo-dark" d="M132.58,121.47c-1.72,2.31-7.3,1.85-9.5.12.25-.38.47-.68.8-1.05,1.53,1.31,5.27,1.77,6.97.7.42-.27.68-.66.67-1.11-.07-2.71-7.37-.8-8.05-4.19-.21-1.02.22-1.96,1.08-2.52,2.18-1.41,5.99-1.19,8.03.31-.35.31-.5.65-.76.99-1.29-.85-2.78-1.1-4.3-.92-.84.1-2.67.24-2.56,1.69.15,1.87,4.18,1.16,6.75,2.47,1.3.66,1.76,2.31.87,3.5Z"/>
                        <path class="logo-dark" d="M68.17,119.53l-4.01.02.02,3.24c-.54.07-1.04.09-1.57.01v-10.04s5.35-.01,5.35-.01c1.39,0,2.69.33,3.8,1.18,1.17,1.17,1.18,3.21-.06,4.35-.93.86-2.21,1.24-3.52,1.25ZM71.01,115.9c-.16-1.43-1.64-1.92-2.93-1.92h-3.95s.04,4.34.04,4.34h4.01c1.35,0,3.01-.77,2.83-2.42Z"/>
                        <path class="logo-dark" d="M88.34,122.82l-1.46-2.6h-6.45s-1.44,2.6-1.44,2.6c-.51.03-.97.04-1.59-.02l5.52-10.04c.56-.05,1.03-.05,1.58,0l2.4,4.44,3.11,5.62-1.67.02ZM86.28,119.04l-2.6-4.83-2.63,4.86,5.23-.03Z"/>
                        <path class="logo-dark" d="M115.71,122.76c-.53.08-1,.1-1.59.06l.03-10.03,1.56-.07v10.04Z"/>
                        <path class="logo-dark" d="M141.83,116.57l.03,6.18c-.51.13-1.03.08-1.58.04l.03-9.97c.48-.08.97-.06,1.49-.03.15,1.25.02,2.49.03,3.79Z"/>
                    </g>
                    <line class="logo-line" x1="177.75" y1="68.61" x2="177.75" y2="123.05"/>
                    <path class="logo-blue" d="M223.84,92.13h20.28v-24.2h-20.28v24.2ZM230.1,90.88h-2.55c1.25-1.13,2.06-2.95,2.06-5.01v-7.23c0-2.05-.81-3.86-2.06-5h2s.55,0,.55,0c.55,0,1.08.09,1.58.26,0,.1-.02.2-.02.3v7.24c0,2.39,1.35,4.46,3.33,5.51-.49,2.25-2.49,3.95-4.89,3.95M228.39,78.64v7.23c0,.19,0,.37-.03.55h-3.3v-12.74c1.88.33,3.33,2.42,3.33,4.96M225.06,90.83v-3.18h3.07c-.49,1.69-1.66,2.94-3.07,3.18M232.88,81.43v-6.95c1.34.9,2.23,2.43,2.23,4.16v6.95c-1.34-.9-2.23-2.43-2.23-4.16M232.99,73.13c.49-2.25,2.49-3.95,4.89-3.95h2.55c-1.25,1.14-2.06,2.95-2.06,5.01v7.24c0,2.05.81,3.86,2.06,5h-1.36s-1.18,0-1.18,0c-.55,0-1.08-.09-1.58-.26,0-.1.02-.2.02-.3v-7.23c0-2.39-1.35-4.46-3.33-5.51M239.59,81.43v-7.24c0-.19,0-.37.03-.55h3.29v12.74c-1.87-.33-3.31-2.43-3.31-4.95M242.91,72.42h-3.06c.49-1.68,1.65-2.93,3.06-3.18v3.18ZM234.2,69.18c-1.14.84-1.99,2.07-2.35,3.48-.56-.16-1.15-.26-1.76-.26h-4.76s-.28,0-.28,0v-3.23h9.14ZM233.78,90.88c1.14-.84,1.99-2.07,2.35-3.48.56.17,1.15.26,1.76.26h5.02v3.23h-9.12Z"/>
                    <path class="logo-blue" d="M196.06,121.24l.68,1.52h-.67l-.67-1.43h-1.06v1.43h-.64v-3.71h1.79c.79,0,1.25.4,1.25,1.07v.14c0,.49-.24.83-.68.98M196.09,120.09c0-.29-.19-.45-.57-.45h-1.18v1.08h1.18c.37,0,.57-.16.57-.45v-.18Z"/>
                    <polygon class="logo-blue" points="198.76 119.64 198.76 120.64 200.59 120.64 200.59 121.24 198.76 121.24 198.76 122.16 200.81 122.16 200.81 122.75 198.12 122.75 198.12 119.05 200.81 119.05 200.81 119.64 198.76 119.64"/>
                    <path class="logo-blue" d="M204.7,121.96h-1.7l-.3.8h-.63l1.29-3.71h.97l1.29,3.71h-.63l-.29-.8ZM203.22,121.36h1.26l-.63-1.73-.63,1.73Z"/>
                    <polygon class="logo-blue" points="209.69 122.16 209.69 122.75 206.95 122.75 206.95 119.05 207.59 119.05 207.59 122.16 209.69 122.16"/>
                    <polygon class="logo-blue" points="213.89 119.64 213.89 120.64 215.72 120.64 215.72 121.24 213.89 121.24 213.89 122.16 215.94 122.16 215.94 122.75 213.25 122.75 213.25 119.05 215.94 119.05 215.94 119.64 213.89 119.64"/>
                    <path class="logo-blue" d="M217.21,121.6v-.13h.64v.15c0,.36.42.61,1.02.61.49,0,.9-.19.9-.57,0-.85-2.48-.18-2.48-1.6,0-.56.41-1.09,1.49-1.09s1.54.5,1.54,1.17v.14h-.64v-.14c0-.32-.36-.57-.91-.57-.5,0-.83.19-.83.49,0,.7,2.47.19,2.48,1.6,0,.64-.52,1.17-1.57,1.17s-1.64-.52-1.64-1.23"/>
                    <polygon class="logo-blue" points="224.75 119.64 223.49 119.64 223.49 122.75 222.85 122.75 222.85 119.64 221.58 119.64 221.58 119.05 224.75 119.05 224.75 119.64"/>
                    <path class="logo-blue" d="M228,121.96h-1.7l-.3.8h-.63l1.29-3.71h.97l1.29,3.71h-.63l-.29-.8ZM226.53,121.36h1.26l-.63-1.73-.63,1.73Z"/>
                    <polygon class="logo-blue" points="232.73 119.64 231.47 119.64 231.47 122.75 230.83 122.75 230.83 119.64 229.56 119.64 229.56 119.05 232.73 119.05 232.73 119.64"/>
                    <polygon class="logo-blue" points="234.68 119.64 234.68 120.64 236.52 120.64 236.52 121.24 234.68 121.24 234.68 122.16 236.74 122.16 236.74 122.75 234.04 122.75 234.04 119.05 236.74 119.05 236.74 119.64 234.68 119.64"/>
                    <path class="logo-blue" d="M243.45,120.13v.27c0,.67-.46,1.08-1.25,1.08h-1.15v1.28h-.64v-3.71h1.79c.79,0,1.25.41,1.25,1.08M242.81,120.11c0-.29-.19-.46-.57-.46h-1.18v1.23h1.18c.37,0,.57-.17.57-.46v-.31Z"/>
                    <path class="logo-blue" d="M246.97,121.96h-1.7l-.3.8h-.63l1.29-3.71h.97l1.29,3.71h-.63l-.29-.8ZM245.49,121.36h1.26l-.63-1.73-.63,1.73Z"/>
                    <path class="logo-blue" d="M251.58,121.24l.68,1.52h-.67l-.67-1.43h-1.06v1.43h-.64v-3.71h1.79c.79,0,1.25.4,1.25,1.07v.14c0,.49-.24.83-.68.98M251.61,120.09c0-.29-.19-.45-.57-.45h-1.18v1.08h1.18c.37,0,.57-.16.57-.45v-.18Z"/>
                    <polygon class="logo-blue" points="256.62 119.64 255.37 119.64 255.37 122.75 254.72 122.75 254.72 119.64 253.46 119.64 253.46 119.05 256.62 119.05 256.62 119.64"/>
                    <polygon class="logo-blue" points="260.91 119.05 260.91 122.75 260.28 122.75 258.57 120.19 258.57 122.75 257.94 122.75 257.94 119.05 258.57 119.05 260.28 121.62 260.28 119.05 260.91 119.05"/>
                    <polygon class="logo-blue" points="263.08 119.64 263.08 120.64 264.91 120.64 264.91 121.24 263.08 121.24 263.08 122.16 265.13 122.16 265.13 122.75 262.43 122.75 262.43 119.05 265.13 119.05 265.13 119.64 263.08 119.64"/>
                    <path class="logo-blue" d="M268.88,121.24l.68,1.52h-.67l-.67-1.43h-1.06v1.43h-.64v-3.71h1.79c.79,0,1.25.4,1.25,1.07v.14c0,.49-.24.83-.68.98M268.91,120.09c0-.29-.19-.45-.57-.45h-1.18v1.08h1.18c.37,0,.57-.16.57-.45v-.18Z"/>
                    <path class="logo-blue" d="M270.83,121.6v-.13h.64v.15c0,.36.42.61,1.02.61.49,0,.9-.19.9-.57,0-.85-2.48-.18-2.48-1.6,0-.56.41-1.09,1.49-1.09s1.54.5,1.54,1.17v.14h-.64v-.14c0-.32-.36-.57-.91-.57-.5,0-.83.19-.83.49,0,.7,2.47.19,2.48,1.6,0,.64-.52,1.17-1.57,1.17s-1.64-.52-1.64-1.23"/>
                    <rect class="logo-dark" x="193.59" y="102.15" width="1.79" height="11.83"/>
                    <rect class="logo-dark" x="231.58" y="102.15" width="1.79" height="2.87"/>
                    <path class="logo-dark" d="M231.58,105.55v4.59c0,1.91-1.24,2.36-2.5,2.36s-2.5-.46-2.5-2.36v-.2h-1.79v.53c0,2.59,1.98,3.71,4.29,3.71s4.29-1.12,4.29-3.71v-4.92h-1.79Z"/>
                    <rect class="logo-dark" x="224.79" y="102.15" width="1.79" height="7.26"/>
                    <polygon class="logo-dark" points="251.57 113.98 249.78 113.98 249.78 103.74 246.54 103.74 246.54 102.15 251.57 102.15 251.57 113.98"/>
                    <rect class="logo-dark" x="252.12" y="102.15" width="2.68" height="1.59"/>
                    <path class="logo-dark" d="M218.31,102.15h-1.14v1.59h.28c1.1,0,1.7.44,1.7,1.61v5.41c0,1.21-.6,1.61-1.7,1.61h-.28v1.61h1.16c1.49,0,2.61-1.17,2.61-2.63v-6.58c0-1.45-1.1-2.63-2.63-2.63"/>
                    <polygon class="logo-dark" points="216.65 112.37 214.51 112.37 214.51 103.74 216.65 103.74 216.65 102.15 212.73 102.15 212.73 113.98 216.65 113.98 216.65 112.37"/>
                    <polygon class="logo-dark" points="259.45 103.81 259.46 103.81 259.46 103.74 261.3 103.74 261.3 102.15 257.68 102.15 257.68 113.98 259.45 113.98 259.45 103.81"/>
                    <path class="logo-dark" d="M263.89,108.85c.98-.37,1.63-1.33,1.63-2.47v-1.61c0-1.45-1.07-2.63-2.52-2.63h-1.17v1.59h.39c1.1,0,1.52.47,1.52,1.45v.77c0,.98-.42,1.45-1.52,1.45h-2.24v1.59h2.08l2.52,4.97h1.94l-2.63-5.13Z"/>
                    <polygon class="logo-dark" points="274.03 108.87 277.69 102.15 275.69 102.15 273.11 107.11 274.03 108.87"/>
                    <polygon class="logo-dark" points="269.94 102.15 267.95 102.15 271.93 109.45 271.93 113.98 273.71 113.98 273.71 109.38 269.94 102.15"/>
                    <polygon class="logo-dark" points="208.74 113.08 208.74 102.15 206.95 102.15 206.95 110.2 208.74 113.08"/>
                    <polygon class="logo-dark" points="201.91 103.03 201.91 105.83 206.95 113.98 208.68 113.98 201.91 103.03"/>
                    <polygon class="logo-dark" points="201.38 102.19 201.36 102.15 199.62 102.15 199.62 113.98 201.38 113.98 201.38 102.19"/>
                    <path class="logo-dark" d="M244.36,110.06c0-1.56-1.03-2.57-2.52-2.75l-2.01-.25c-1.14-.14-1.37-.74-1.37-1.44v-.09h-1.79v.33c0,1.56,1.03,2.71,2.57,2.89l1.93.23c1.23.14,1.4.65,1.4,1.44,0,.18,0,.32,0,.33,0,1.21-.6,1.61-1.7,1.61h-.14v1.61h1.02c1.49,0,2.61-1.17,2.61-2.63,0,0,0-.6,0-1.3"/>
                    <rect class="logo-dark" x="236.89" y="112.36" width="3.32" height="1.63"/>
                </svg>
            </div>
        </div>

        <div class="content">
            <div class="input-panel">
                <button class="calculate-btn" onclick="calculate()" style="margin-bottom: 25px;">Calculate Analysis</button>

                <div class="section">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 6px; font-size: 1.1em; font-weight: 600; margin-bottom: 10px; text-align: center;">Step 1</div>
                    <h3>Enter Current/Anticipated Lease Cost</h3>
                    <div class="input-group">
                        <label>Enter Current Monthly Rent ($)</label>
                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px; padding: 0; transition: border-color 0.3s;" id="rentWrapper">
                            <span style="padding: 10px 0 10px 10px; color: #666; font-weight: 600;">$</span>
                            <input type="text" id="currentRentDisplay" value="15,000" style="border: none; padding: 10px 10px 10px 5px; flex: 1; font-size: 0.95em;" oninput="formatRentInput()" onfocus="document.getElementById('rentWrapper').style.borderColor='#667eea'" onblur="document.getElementById('rentWrapper').style.borderColor='#ddd'">
                        </div>
                        <input type="hidden" id="currentRent" value="15000">
                    </div>
                    <div class="input-group">
                        <label>Enter Other Monthly Expenses ($)</label>
                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px; padding: 0; transition: border-color 0.3s;" id="expensesWrapper">
                            <span style="padding: 10px 0 10px 10px; color: #666; font-weight: 600;">$</span>
                            <input type="text" id="otherExpensesDisplay" value="0" style="border: none; padding: 10px 10px 10px 5px; flex: 1; font-size: 0.95em;" oninput="formatExpensesInput()" onfocus="document.getElementById('expensesWrapper').style.borderColor='#667eea'" onblur="document.getElementById('expensesWrapper').style.borderColor='#ddd'">
                        </div>
                        <input type="hidden" id="otherExpenses" value="0">
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            e.g., parking fees, additional rent, CAM charges
                        </small>
                    </div>
                    <div class="input-group">
                        <label>Total Monthly Real Estate Expense ($)</label>
                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px; padding: 0; background: #f0f0f0;">
                            <span style="padding: 10px 0 10px 10px; color: #666; font-weight: 600;">$</span>
                            <input type="text" id="totalMonthlyExpenseDisplay" value="15,000" style="border: none; padding: 10px 10px 10px 5px; flex: 1; font-size: 0.95em; background: #f0f0f0; font-weight: 600;" readonly>
                        </div>
                        <input type="hidden" id="totalMonthlyExpense" value="15000">
                    </div>
                    <div class="input-group">
                        <label>Current Annual Real Estate Expense ($)</label>
                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px; padding: 0; background: #f0f0f0;">
                            <span style="padding: 10px 0 10px 10px; color: #666; font-weight: 600;">$</span>
                            <input type="text" id="currentAnnualRentDisplay" value="180,000" style="border: none; padding: 10px 10px 10px 5px; flex: 1; font-size: 0.95em; background: #f0f0f0; font-weight: 600;" readonly>
                        </div>
                        <input type="hidden" id="currentAnnualRent" value="180000">
                    </div>
                </div>

                <div class="section">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 6px; font-size: 1.1em; font-weight: 600; margin-bottom: 10px; text-align: center;">Step 2</div>
                    <h3>Define Building Requirements</h3>
                    
                    <!-- Building Size Slider -->
                    <div class="slider-container" style="margin-bottom: 15px;">
                        <div class="slider-header">
                            <h4>Select Desired Building Size: <span class="slider-value" id="buildingSizeDisplay">10,000 SF</span></h4>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn" style="background: #3498db;" onclick="adjustSlider('buildingSize', -250)">←</button>
                            <div class="slider-track">
                                <input type="range" id="buildingSize" class="slider-input" min="1250" max="50000" step="250" value="10000" oninput="updateSliderDisplay('buildingSize', ' SF')">
                            </div>
                            <button class="slider-btn" style="background: #3498db;" onclick="adjustSlider('buildingSize', 250)">→</button>
                        </div>
                        <div class="slider-labels">
                            <span>1,250 SF</span>
                            <span>50,000 SF</span>
                        </div>
                    </div>
                    
                    <div style="background: #e7f3ff; border-left: 4px solid #1890ff; padding: 12px; border-radius: 5px;">
                        <p style="color: #555; font-size: 0.9em; margin-bottom: 8px;">
                            <strong>Need help estimating your future space need?</strong>
                        </p>
                        <a href="https://mparisi05.github.io/Commercial-Space-Calculator/" target="_blank" style="display: inline-block; padding: 8px 16px; background: #1890ff; color: white; text-decoration: none; border-radius: 5px; font-size: 0.9em; font-weight: 600; transition: background 0.2s;" onmouseover="this.style.background='#0070d9'" onmouseout="this.style.background='#1890ff'">
                            Launch Space Calculator →
                        </a>
                    </div>
                </div>

                <div class="section">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 6px; font-size: 1.1em; font-weight: 600; margin-bottom: 10px; text-align: center;">Step 3</div>
                    <h3>Your Business Financials</h3>
                    <div class="input-group">
                        <label>Annual Free Cash Flow ($)</label>
                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px; padding: 0; transition: border-color 0.3s;" id="cashFlowWrapper">
                            <span style="padding: 10px 0 10px 10px; color: #666; font-weight: 600;">$</span>
                            <input type="text" id="freeCashFlowDisplay" value="300,000" style="border: none; padding: 10px 10px 10px 5px; flex: 1; font-size: 0.95em;" oninput="formatCashFlowInput()" onfocus="document.getElementById('cashFlowWrapper').style.borderColor='#667eea'" onblur="document.getElementById('cashFlowWrapper').style.borderColor='#ddd'">
                        </div>
                        <input type="hidden" id="freeCashFlow" value="300000">
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            Net Operating Income available for debt service
                        </small>
                    </div>
                </div>

                <div class="section">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 6px; font-size: 1.1em; font-weight: 600; margin-bottom: 10px; text-align: center;">Step 4</div>
                    <h3>Select Target Submarkets</h3>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px; font-style: italic;">
                        Select one or multiple submarkets to compare. When multiple markets are selected, pricing will be averaged.
                    </p>
                    
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Forsyth" data-q1="145.43" data-avg="153.60" data-q3="160.49" data-size-adj-modifier="0.5">
                            <div>
                                <strong>Forsyth</strong> (Avg: $154/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">North Alpharetta, Cumming</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Cherokee County" data-q1="160.87" data-avg="225.80" data-q3="293.94">
                            <div>
                                <strong>Cherokee County</strong> (Avg: $226/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Woodstock, Holly Springs, Canton, Kiethsburg, Ball Ground</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Kennesaw/Town Center" data-q1="130.35" data-avg="174.88" data-q3="213.95">
                            <div>
                                <strong>Kennesaw/Town Center</strong> (Avg: $175/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Kennesaw, Acworth, Northwest Marietta, Dallas, Wildwood, New Hope, Yorkville</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="North Fulton" data-q1="183.25" data-avg="281.49" data-q3="384.28">
                            <div>
                                <strong>North Fulton</strong> (Avg: $281/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Roswell, Alpharetta, Johns Creek, Milton</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Dulututh/Suwanee/Buford" data-q1="142.15" data-avg="187.31" data-q3="228.92">
                            <div>
                                <strong>Duluth/Suwanee/Buford</strong> (Avg: $187/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Duluth, Suwanee, Sugar Hill, Buford</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Lawrenceville/Lilburn" data-q1="147.79" data-avg="173.30" data-q3="189.04">
                            <div>
                                <strong>Lawrenceville/Lilburn</strong> (Avg: $173/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Lawrenceville, Lilburn, Grayson, Dacula</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="East Cobb" data-q1="109.50" data-avg="158.63" data-q3="188.07">
                            <div>
                                <strong>East Cobb</strong> (Avg: $159/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Marietta, West Roswell</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Cumberland/Galleria" data-q1="120.94" data-avg="160.45" data-q3="178.49">
                            <div>
                                <strong>Cumberland/Galleria</strong> (Avg: $160/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Vinings, NW Buckhead, Smyrna, Marietta</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Norcross/Peachtree Corners" data-q1="107.44" data-avg="154.08" data-q3="199.61">
                            <div>
                                <strong>Norcross/Peachtree Corners</strong> (Avg: $154/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Norcross, Peachtree Corners</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Northlake/Lavista" data-q1="84.63" data-avg="94.03" data-q3="103.42">
                            <div>
                                <strong>Northlake/Lavista</strong> (Avg: $94/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Northlake, North Decatur, Tucker</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Central Perimeter" data-q1="151.87" data-avg="235.21" data-q3="311.87">
                            <div>
                                <strong>Central Perimeter</strong> (Avg: $235/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Sandy Springs, Lower Roswell, Dunwoody, North Brookhaven</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Chamblee/Dville/N D Hills" data-q1="146.94" data-avg="196.33" data-q3="287.00">
                            <div>
                                <strong>Chamblee/Dville/N D Hills</strong> (Avg: $196/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Chamblee, Doraville, N Druid Hills, Morning Side</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Buckhead" data-q1="418.51" data-avg="423.18" data-q3="490.03">
                            <div>
                                <strong>Buckhead</strong> (Avg: $423/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Buckhead, Brookhaven, Peachtree Hills</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Midtown" data-q1="359.16" data-avg="412.47" data-q3="440.77">
                            <div>
                                <strong>Midtown</strong> (Avg: $412/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Midtown, West Midtown, Virginia Highlands, Ansley</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Decatur" data-q1="137.73" data-avg="235.38" data-q3="318.51">
                            <div>
                                <strong>Decatur</strong> (Avg: $235/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Decatur, Druid Hills</div>
                            </div>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" class="submarket" value="Downtown" data-q1="264.74" data-avg="412.47" data-q3="409.74">
                            <div>
                                <strong>Downtown</strong> (Avg: $412/SF)
                                <div style="font-size: 0.85em; color: #777; margin-top: 3px;">Downtown, Old Fourth Ward, Inman Park</div>
                            </div>
                        </label>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculate()" style="margin: 25px 0;">Calculate Analysis</button>

                <div class="section">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 6px; font-size: 1.1em; font-weight: 600; margin-bottom: 10px; text-align: center;">Step 5</div>
                    <h3>Set Your Financing Parameters</h3>
                    
                    <!-- Debt Coverage Ratio Slider -->
                    <div class="slider-container dcr-slider">
                        <div class="slider-header">
                            <h4>Debt Coverage Ratio (DCR): <span class="slider-value" id="dcrDisplay">1.20x</span></h4>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn" onclick="adjustSlider('dcr', -0.01)">←</button>
                            <div class="slider-track">
                                <input type="range" id="dcr" class="slider-input" min="1.20" max="1.25" step="0.01" value="1.20" oninput="updateSliderDisplay('dcr', 'x')">
                            </div>
                            <button class="slider-btn" onclick="adjustSlider('dcr', 0.01)">→</button>
                        </div>
                        <div class="slider-labels">
                            <span>1.20x</span>
                            <span>1.25x</span>
                        </div>
                        <div class="slider-indicators">
                            <span class="more-power">← More Power</span>
                            <span class="less-power">Less Power →</span>
                        </div>
                        <div class="slider-description">
                            DCR measures your ability to cover debt payments. A 1.25x ratio means your free cash flow is 1.25 times your total expenses, providing a 25% cushion. Lenders typically require 1.20-1.25x to approve financing.
                        </div>
                    </div>

                    <!-- Down Payment Slider -->
                    <div class="slider-container down-slider">
                        <div class="slider-header">
                            <h4>Down Payment: <span class="slider-value" id="downPaymentDisplay">15%</span></h4>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn" onclick="adjustSlider('downPayment', -5)">←</button>
                            <div class="slider-track">
                                <input type="range" id="downPayment" class="slider-input" min="5" max="35" step="5" value="15" oninput="updateSliderDisplay('downPayment', '%')">
                            </div>
                            <button class="slider-btn" onclick="adjustSlider('downPayment', 5)">→</button>
                        </div>
                        <div class="slider-labels">
                            <span>5% (SBA)</span>
                            <span>35% (Conv)</span>
                        </div>
                        <div class="slider-indicators">
                            <span class="less-power">← Less Power</span>
                            <span class="more-power">More Power →</span>
                        </div>
                    </div>

                    <!-- Interest Rate Slider -->
                    <div class="slider-container rate-slider">
                        <div class="slider-header">
                            <h4>Interest Rate: <span class="slider-value" id="interestRateDisplay">5.50%</span></h4>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn" onclick="adjustSlider('interestRate', -0.25)">←</button>
                            <div class="slider-track">
                                <input type="range" id="interestRate" class="slider-input" min="4.00" max="9.00" step="0.25" value="5.50" oninput="updateSliderDisplay('interestRate', '%')">
                            </div>
                            <button class="slider-btn" onclick="adjustSlider('interestRate', 0.25)">→</button>
                        </div>
                        <div class="slider-labels">
                            <span>4.00%</span>
                            <span>9.00%</span>
                        </div>
                        <div class="slider-indicators">
                            <span class="more-power">← More Power</span>
                            <span class="less-power">Less Power →</span>
                        </div>
                    </div>

                    <!-- Loan Term Slider -->
                    <div class="slider-container term-slider">
                        <div class="slider-header">
                            <h4>Loan Term: <span class="slider-value" id="loanTermDisplay">25 years</span></h4>
                        </div>
                        <div class="slider-controls">
                            <button class="slider-btn" onclick="adjustSlider('loanTerm', -5)">←</button>
                            <div class="slider-track">
                                <input type="range" id="loanTerm" class="slider-input" min="10" max="25" step="5" value="25" oninput="updateSliderDisplay('loanTerm', ' years')">
                            </div>
                            <button class="slider-btn" onclick="adjustSlider('loanTerm', 5)">→</button>
                        </div>
                        <div class="slider-labels">
                            <span>10 years</span>
                            <span>25 years</span>
                        </div>
                        <div class="slider-indicators">
                            <span class="less-power">← Less Power</span>
                            <span class="more-power">More Power →</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-panel" id="results">
                <div style="text-align: center; padding: 60px 20px; color: #666;">
                    <div style="font-size: 4em; margin-bottom: 20px;">📊</div>
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Ready to Analyze Your Options</h3>
                    <p style="font-size: 1.1em; line-height: 1.6;">
                        Enter your current lease costs, select your target markets, adjust financing parameters, and click <strong>Calculate Analysis</strong> to see a detailed comparison of owning vs. leasing.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let hasCalculated = false;

        // Format rent input with commas
        function formatRentInput() {
            const display = document.getElementById('currentRentDisplay');
            const hidden = document.getElementById('currentRent');
            
            // Remove all non-numeric characters
            let value = display.value.replace(/[^\d]/g, '');
            
            // Parse as number
            let numValue = parseFloat(value) || 0;
            
            // Store the raw number in hidden field
            hidden.value = numValue;
            
            // Format with commas for display
            display.value = numValue.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            
            updateTotals();
        }

        function formatExpensesInput() {
            const display = document.getElementById('otherExpensesDisplay');
            const hidden = document.getElementById('otherExpenses');
            
            // Remove all non-numeric characters
            let value = display.value.replace(/[^\d]/g, '');
            
            // Parse as number
            let numValue = parseFloat(value) || 0;
            
            // Store the raw number in hidden field
            hidden.value = numValue;
            
            // Format with commas for display
            display.value = numValue.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            
            updateTotals();
        }
        
        function updateTotals() {
            const monthlyRent = parseFloat(document.getElementById('currentRent').value) || 0;
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value) || 0;
            const totalMonthly = monthlyRent + otherExpenses;
            
            // Update hidden fields
            document.getElementById('totalMonthlyExpense').value = totalMonthly.toFixed(0);
            document.getElementById('currentAnnualRent').value = (totalMonthly * 12).toFixed(0);
            
            // Update display fields with formatting
            document.getElementById('totalMonthlyExpenseDisplay').value = totalMonthly.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            document.getElementById('currentAnnualRentDisplay').value = (totalMonthly * 12).toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
        }

        // Global function to handle quality selection
        function selectQuality(quality) {
            // Store the selected quality
            window.selectedQuality = quality;
            // Recalculate with the new quality
            calculate();
        }

        // Slider control functions
        function updateSliderDisplay(sliderId, suffix) {
            const slider = document.getElementById(sliderId);
            const display = document.getElementById(sliderId + 'Display');
            let value = parseFloat(slider.value);
            
            if (sliderId === 'dcr') {
                display.textContent = value.toFixed(2) + suffix;
            } else if (sliderId === 'interestRate') {
                display.textContent = value.toFixed(2) + suffix;
            } else if (sliderId === 'downPayment') {
                display.textContent = Math.round(value) + suffix;
            } else if (sliderId === 'loanTerm') {
                display.textContent = Math.round(value) + suffix;
            } else if (sliderId === 'buildingSize') {
                display.textContent = Math.round(value).toLocaleString('en-US') + suffix;
            }
        }

        function adjustSlider(sliderId, adjustment) {
            const slider = document.getElementById(sliderId);
            let currentValue = parseFloat(slider.value);
            let newValue = currentValue + adjustment;
            
            // Constrain to min/max
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            newValue = Math.max(min, Math.min(max, newValue));
            
            slider.value = newValue;
            
            // Trigger display update
            let suffix = '';
            if (sliderId === 'dcr') suffix = 'x';
            else if (sliderId === 'interestRate' || sliderId === 'downPayment') suffix = '%';
            else if (sliderId === 'loanTerm') suffix = ' years';
            else if (sliderId === 'buildingSize') suffix = ' SF';
            
            updateSliderDisplay(sliderId, suffix);
        }

        // Format free cash flow input with commas
        function formatCashFlowInput() {
            const display = document.getElementById('freeCashFlowDisplay');
            const hidden = document.getElementById('freeCashFlow');
            
            // Remove all non-numeric characters except decimal point
            let value = display.value.replace(/[^\d.]/g, '');
            
            // Parse as number
            let numValue = parseFloat(value) || 0;
            
            // Store the raw number in hidden field
            hidden.value = numValue;
            
            // Format with commas for display
            display.value = numValue.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
        }

        // Initialize on load
        window.addEventListener('load', function() {
            formatCashFlowInput();
            formatRentInput();
            formatExpensesInput();
        });

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function formatNumber(value, decimals = 0) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(value);
        }

        // Calculate size-based adjustment factor
        function getSizeAdjustmentFactor(buildingSize) {
            if (buildingSize <= 10000) {
                return 1.00; // 100% of average (baseline)
            } else if (buildingSize <= 20000) {
                // 10,001-20,000 SF: 85-90%
                // Linear interpolation between 90% at 10,001 and 85% at 20,000
                const progress = (buildingSize - 10000) / 10000;
                return 0.90 - (progress * 0.05);
            } else if (buildingSize <= 40000) {
                // 20,001-40,000 SF: 75-85%
                // Linear interpolation between 85% at 20,001 and 75% at 40,000
                const progress = (buildingSize - 20000) / 20000;
                return 0.85 - (progress * 0.10);
            } else {
                // 40,000+ SF: 65-75%
                // Linear interpolation between 75% at 40,001 and 65% at 80,000+
                const progress = Math.min((buildingSize - 40000) / 40000, 1.0);
                return 0.75 - (progress * 0.10);
            }
        }

        function calculateMortgage(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            
            if (monthlyRate === 0) {
                return principal / numPayments;
            }
            
            const monthlyPayment = principal * 
                (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            return monthlyPayment;
        }

        function calculate() {
            // Get input values
            const currentRent = parseFloat(document.getElementById('currentRent').value) || 0;
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value) || 0;
            const totalCurrentMonthly = currentRent + otherExpenses;
            const buildingSize = parseFloat(document.getElementById('buildingSize').value) || 0;
            const downPaymentPct = parseFloat(document.getElementById('downPayment').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 0;
            const opexPerSF = 8.00; // Fixed at $8/SF
            const freeCashFlow = parseFloat(document.getElementById('freeCashFlow').value) || 0;
            const dcr = parseFloat(document.getElementById('dcr').value) || 1.20;

            // Get selected submarkets
            const checkboxes = document.querySelectorAll('.submarket:checked');
            
            if (checkboxes.length === 0) {
                document.getElementById('results').innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #666;">
                        <div style="font-size: 4em; margin-bottom: 20px;">📍</div>
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">Please Select at Least One Submarket</h3>
                        <p style="font-size: 1.1em; line-height: 1.6;">
                            Go to <strong>Step 4</strong> and check one or more target submarkets to see your analysis.
                        </p>
                    </div>
                `;
                return;
            }

            // Calculate average prices from selected submarkets
            // Handle size adjustment with modifiers for markets that have reduced scaling
            let q1SumAdjusted = 0, avgSumAdjusted = 0, q3SumAdjusted = 0;
            let selectedMarkets = [];
            
            // Apply size-based adjustment factor
            const sizeAdjustment = getSizeAdjustmentFactor(buildingSize);
            const discount = 1 - sizeAdjustment; // e.g., 0.15 for 85% adjustment
            
            checkboxes.forEach(cb => {
                const q1 = parseFloat(cb.dataset.q1);
                const avg = parseFloat(cb.dataset.avg);
                const q3 = parseFloat(cb.dataset.q3);
                const sizeAdjModifier = parseFloat(cb.dataset.sizeAdjModifier) || 1.0; // 1.0 = full discount, 0.5 = half discount
                
                // Calculate adjusted factor: apply only portion of the discount based on modifier
                const adjustedDiscount = discount * sizeAdjModifier;
                const adjFactor = 1 - adjustedDiscount;
                
                q1SumAdjusted += q1 * adjFactor;
                avgSumAdjusted += avg * adjFactor;
                q3SumAdjusted += q3 * adjFactor;
                selectedMarkets.push(cb.value);
            });

            const count = checkboxes.length;
            
            // These are now already adjusted (with reduced adjustment for Forsyth)
            const adjustedQ1Price = q1SumAdjusted / count;
            const adjustedAvgPrice = avgSumAdjusted / count;
            const adjustedQ3Price = q3SumAdjusted / count;
            
            // Calculate unadjusted prices for purchasing power calculations
            let q1Sum = 0, avgSum = 0, q3Sum = 0;
            checkboxes.forEach(cb => {
                q1Sum += parseFloat(cb.dataset.q1);
                avgSum += parseFloat(cb.dataset.avg);
                q3Sum += parseFloat(cb.dataset.q3);
            });
            const q1Price = q1Sum / count;
            const avgPrice = avgSum / count;
            const q3Price = q3Sum / count;

            // Get selected quality level (from global variable or default to 'avg')
            const selectedQuality = window.selectedQuality || 'avg';
            
            // Create all three scenarios
            const scenarios = [
                { name: 'Lower-End', pricePerSF: adjustedQ1Price, class: 'low', quality: 'q1' },
                { name: 'Average', pricePerSF: adjustedAvgPrice, class: 'average', quality: 'avg' },
                { name: 'Higher-End', pricePerSF: adjustedQ3Price, class: 'high', quality: 'q3' }
            ];
            
            // Find the selected scenario for comparison section
            const selectedScenario = scenarios.find(s => s.quality === selectedQuality) || scenarios[1];

            let resultsHTML = '';

            // Selected markets info
            resultsHTML += `
                <div class="info-box">
                    <p><strong>Selected Markets:</strong> ${selectedMarkets.join(', ')}</p>
                </div>
            `;

            // Store building size and financing info for later use
            const buildingFinancingInfo = `
                <div class="info-box" style="margin-bottom: 15px;">
                    <p><strong>Building Size:</strong> ${formatNumber(buildingSize)} SF | 
                    <strong>Financing:</strong> ${downPaymentPct}% down, ${interestRate}% rate, ${loanTerm} years</p>
                    ${otherExpenses > 0 ? `
                        <p style="margin-top: 8px;"><strong>Current Expenses:</strong> Rent ${formatCurrency(currentRent)}/mo + Other ${formatCurrency(otherExpenses)}/mo = ${formatCurrency(totalCurrentMonthly)}/mo</p>
                    ` : ''}
                    ${sizeAdjustment < 1.0 ? `
                        <p style="margin-top: 8px;"><strong>Size Adjustment:</strong> ${(sizeAdjustment * 100).toFixed(0)}% of small-building average (larger buildings trade at lower $/SF)</p>
                    ` : ''}
                </div>
            `;

            // Scenario cards - SHOW ALL THREE (store in variable first)
            let scenarioCardsHTML = '<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 8px; font-size: 1.4em; font-weight: 700; margin: 30px 0 20px 0; text-align: center;">Financial Breakdown</div>';
            scenarioCardsHTML += buildingFinancingInfo;
            scenarioCardsHTML += '<div class="scenario-cards">';
            
            scenarios.forEach(scenario => {
                const purchasePrice = buildingSize * scenario.pricePerSF;
            const downPaymentAmount = purchasePrice * (downPaymentPct / 100);
            const loanAmount = purchasePrice - downPaymentAmount;
            const monthlyMortgage = calculateMortgage(loanAmount, interestRate, loanTerm);
            const annualMortgage = monthlyMortgage * 12;
            const annualOpex = buildingSize * opexPerSF;
            const totalAnnualCost = annualMortgage + annualOpex;
            const monthlyTotal = totalAnnualCost / 12;

            scenarioCardsHTML += `
                <div class="scenario-card ${scenario.class}">
                    <h4>${scenario.name}</h4>
                    ${scenario.quality === 'q1' ? '<p style="font-size: 0.85em; color: #666; margin: -10px 0 15px 0; font-style: italic;">lower quality</p>' : ''}
                    ${scenario.quality === 'q3' ? '<p style="font-size: 0.85em; color: #666; margin: -10px 0 15px 0; font-style: italic;">higher quality</p>' : ''}
                    
                    <div class="metric">
                        <div class="metric-label">Price per SF</div>
                        <div class="metric-value">${formatCurrency(scenario.pricePerSF)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Purchase Price</div>
                        <div class="metric-value">${formatCurrency(purchasePrice)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Down Payment (${downPaymentPct}%)</div>
                        <div class="metric-value">${formatCurrency(downPaymentAmount)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Loan Amount</div>
                        <div class="metric-value">${formatCurrency(loanAmount)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Monthly Mortgage</div>
                        <div class="metric-value">${formatCurrency(monthlyMortgage)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Annual Operating Expenses</div>
                        <div class="metric-value">${formatCurrency(annualOpex)}</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Monthly Total Cost</div>
                        <div class="metric-value" style="color: #e74c3c; font-size: 1.4em;">${formatCurrency(monthlyTotal)}</div>
                    </div>
                </div>
            `;
            });
            
            scenarioCardsHTML += '</div>';

            // Calculate purchase price for selected scenario (for use in affordability analysis)
            const selectedPurchasePrice = buildingSize * selectedScenario.pricePerSF;

            // Purchasing Power Analysis - CALCULATE THIS FIRST
            // Use LOWER QUARTILE pricing for maximum purchasing power calculation
            // Note: We'll calculate max size WITHOUT adjustment first, then apply adjustment
            const q1PriceForMax = q1Price; // Using unadjusted Q1 price for iteration
            const avgPriceForAffordability = avgPrice; // Using unadjusted avg price
            
            const maxAnnualDebtService = freeCashFlow / dcr;
            const maxMonthlyPayment = maxAnnualDebtService / 12;
            
            // First, we need to account for operating expenses
            // Available cash for mortgage = (Free Cash Flow / DCR) - Operating Expenses
            // We'll calculate max building size iteratively since OpEx depends on building size
            
            // Using LOWER QUARTILE price, solve for building size where:
            // (Mortgage Payment * 12 + OpEx * Size) * DCR <= Free Cash Flow
            
            const monthlyRate = interestRate / 100 / 12;
            const numPayments = loanTerm * 12;
            
            // Helper function to calculate monthly mortgage payment
            function calcMortgagePayment(principal, rate, periods) {
                if (rate === 0) return principal / periods;
                return principal * (rate * Math.pow(1 + rate, periods)) / (Math.pow(1 + rate, periods) - 1);
            }
            
            // Iteratively solve for max building size
            let maxBuildingSize = 0;
            let testSize = 1000; // Start with 1,000 SF
            let increment = 1000;
            let lastValidSize = 0;
            
            // Binary search for optimal size
            let low = 0;
            let high = 100000; // Max test of 100,000 SF
            
            while (high - low > 1) {
                testSize = Math.floor((low + high) / 2);
                const testSizeAdjustment = getSizeAdjustmentFactor(testSize);
                const testPricePerSF = q1PriceForMax * testSizeAdjustment; // Apply adjustment based on test size
                const testPurchasePrice = testSize * testPricePerSF;
                const testDownPayment = testPurchasePrice * (downPaymentPct / 100);
                const testLoanAmount = testPurchasePrice - testDownPayment;
                const testMonthlyMortgage = calcMortgagePayment(testLoanAmount, monthlyRate, numPayments);
                const testAnnualMortgage = testMonthlyMortgage * 12;
                const testAnnualOpex = testSize * opexPerSF;
                const testTotalAnnualCost = testAnnualMortgage + testAnnualOpex;
                const testRequiredCashFlow = testTotalAnnualCost * dcr;
                
                if (testRequiredCashFlow <= freeCashFlow) {
                    lastValidSize = testSize;
                    low = testSize;
                } else {
                    high = testSize;
                }
            }
            
            maxBuildingSize = lastValidSize;
            
            // Calculate final values based on max size using lower quartile pricing WITH SIZE ADJUSTMENT
            const maxSizeAdjustment = getSizeAdjustmentFactor(maxBuildingSize);
            const maxAdjustedQ1Price = q1PriceForMax * maxSizeAdjustment;
            const maxPurchasePrice = maxBuildingSize * maxAdjustedQ1Price;
            const maxDownPayment = maxPurchasePrice * (downPaymentPct / 100);
            const maxLoanAmount = maxPurchasePrice - maxDownPayment;
            const maxMonthlyMortgage = calcMortgagePayment(maxLoanAmount, monthlyRate, numPayments);
            const maxAnnualMortgage = maxMonthlyMortgage * 12;
            const maxAnnualOpex = maxBuildingSize * opexPerSF;
            const maxTotalAnnualCost = maxAnnualMortgage + maxAnnualOpex;

            // Now calculate affordability using AVERAGE pricing (adjusted for size)
            // Calculate the affordable size at average pricing
            low = 0;
            high = 100000;
            let avgAffordableSize = 0;
            
            while (high - low > 1) {
                testSize = Math.floor((low + high) / 2);
                const testSizeAdjustment = getSizeAdjustmentFactor(testSize);
                const testPricePerSF = avgPriceForAffordability * testSizeAdjustment;
                const testPurchasePrice = testSize * testPricePerSF;
                const testDownPayment = testPurchasePrice * (downPaymentPct / 100);
                const testLoanAmount = testPurchasePrice - testDownPayment;
                const testMonthlyMortgage = calcMortgagePayment(testLoanAmount, monthlyRate, numPayments);
                const testAnnualMortgage = testMonthlyMortgage * 12;
                const testAnnualOpex = testSize * opexPerSF;
                const testTotalAnnualCost = testAnnualMortgage + testAnnualOpex;
                const testRequiredCashFlow = testTotalAnnualCost * dcr;
                
                if (testRequiredCashFlow <= freeCashFlow) {
                    avgAffordableSize = testSize;
                    low = testSize;
                } else {
                    high = testSize;
                }
            }
            
            // For display, recalculate the adjusted price at the affordable size
            const avgAffordableSizeAdjustment = getSizeAdjustmentFactor(avgAffordableSize);
            const avgAffordableAdjustedPrice = avgPriceForAffordability * avgAffordableSizeAdjustment;
            
            // Determine if the desired building size is affordable at average pricing
            const avgAffordableSizeFinal = avgAffordableSize;
            const isAffordable = buildingSize <= avgAffordableSizeFinal;
            const sizeDifference = avgAffordableSizeFinal - buildingSize;
            const sizePercentDiff = (sizeDifference / buildingSize) * 100;
            const isClose = isAffordable && sizePercentDiff < 15; // Within 15% of max

            // Comparison section - use selected quality
            const selectedPricePerSF = selectedScenario.pricePerSF;
            const selectedDownPaymentAmount = selectedPurchasePrice * (downPaymentPct / 100);
            const selectedLoanAmount = selectedPurchasePrice - selectedDownPaymentAmount;
            const selectedMonthlyMortgage = calculateMortgage(selectedLoanAmount, interestRate, loanTerm);
            const selectedAnnualMortgage = selectedMonthlyMortgage * 12;
            const selectedAnnualOpex = buildingSize * opexPerSF;
            const selectedTotalAnnualCost = selectedAnnualMortgage + selectedAnnualOpex;
            const selectedMonthlyTotal = selectedTotalAnnualCost / 12;

            const currentAnnualRent = totalCurrentMonthly * 12;
            const monthlySavings = totalCurrentMonthly - selectedMonthlyTotal;
            const annualSavings = monthlySavings * 12;

            resultsHTML += `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 8px; font-size: 1.4em; font-weight: 700; margin: 30px 0 20px 0; text-align: center;">Monthly Cost Comparison</div>
                <div class="comparison-section">
                    <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
                        <div class="quality-buttons">
                            <button class="quality-btn ${selectedQuality === 'q1' ? 'active' : ''}" onclick="selectQuality('q1')">Lower-End</button>
                            <button class="quality-btn ${selectedQuality === 'avg' ? 'active' : ''}" onclick="selectQuality('avg')">Average</button>
                            <button class="quality-btn ${selectedQuality === 'q3' ? 'active' : ''}" onclick="selectQuality('q3')">Higher-End</button>
                        </div>
                    </div>
                    
                    <div class="comparison-grid">
                        <div class="comparison-item current">
                            <h4>Current Leasing Cost</h4>
                            <div class="amount">${formatCurrency(totalCurrentMonthly)}/mo</div>
                            <div>${formatCurrency(currentAnnualRent)}/year</div>
                        </div>
                        
                        <div class="comparison-item ownership">
                            <h4>Ownership Cost (${selectedScenario.name})</h4>
                            <div class="amount">${formatCurrency(selectedMonthlyTotal)}/mo</div>
                            <div>${formatCurrency(selectedTotalAnnualCost)}/year</div>
                        </div>
                    </div>
                    
                    <div class="savings ${monthlySavings < 0 ? 'negative' : ''}">
                        <h4>${monthlySavings >= 0 ? 'Monthly Savings with Ownership' : 'Additional Monthly Cost'}</h4>
                        <div class="amount">${formatCurrency(Math.abs(monthlySavings))}/mo</div>
                        <div>${formatCurrency(Math.abs(annualSavings))}/year</div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <p><strong>Note:</strong> Ownership costs include mortgage payment (${formatCurrency(selectedMonthlyMortgage)}/mo) + operating expenses (${formatCurrency(selectedAnnualOpex / 12)}/mo at ${formatCurrency(opexPerSF)}/SF). This does not include potential tax benefits, appreciation, or equity buildup.</p>
                    </div>
                </div>
            `;

            // Add scenario cards after comparison
            resultsHTML += scenarioCardsHTML;

            // Purchasing Power Summary
            resultsHTML += `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 8px; font-size: 1.4em; font-weight: 700; margin: 30px 0 20px 0; text-align: center;">💰 Your Purchasing Power</div>
                <div class="purchasing-power">
                    
                    <div class="info-box" style="margin-bottom: 20px;">
                        <p><strong>Based on:</strong> ${formatCurrency(freeCashFlow)} annual free cash flow, ${dcr}x DCR requirement, ${downPaymentPct}% down payment, ${interestRate}% interest rate, ${loanTerm}-year term</p>
                    </div>
                    
                    <div class="power-metric">
                        <h4>Maximum Debt Capacity</h4>
                        <div class="value">${formatCurrency(maxAnnualDebtService)}/year</div>
                        <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">
                            ${formatCurrency(maxAnnualDebtService / 12)}/month available for mortgage + expenses
                        </div>
                    </div>
                    
                    <div class="power-metric">
                        <h4>Maximum Purchase Price</h4>
                        <div class="value">${formatCurrency(maxPurchasePrice)}</div>
                        <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">
                            with ${downPaymentPct}% down (${formatCurrency(maxDownPayment)})
                        </div>
                    </div>
                    
                    <div class="power-metric">
                        <h4>Maximum Building Size</h4>
                        <div class="value">${formatNumber(maxBuildingSize, 0)} SF</div>
                        <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">
                            at average price of ${formatCurrency(avgPrice)}/SF
                        </div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px; background: #d4edda; border-left-color: #28a745;">
                        <p><strong>✓ Complete Analysis:</strong> This calculation includes both mortgage payments AND operating expenses (${formatCurrency(opexPerSF)}/SF) in the debt coverage ratio, giving you a true picture of your purchasing power.</p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 8px; font-size: 1.4em; font-weight: 700; margin: 30px 0 20px 0; text-align: center;">📊 Affordability Analysis</div>
                <div class="purchasing-power">
                    
                    <div style="background: ${isAffordable ? (isClose ? '#fff3cd' : '#d4edda') : '#f8d7da'}; 
                                border-left: 4px solid ${isAffordable ? (isClose ? '#ffc107' : '#28a745') : '#e57373'}; 
                                padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #2c3e50; font-size: 1.2em;">
                            ${isAffordable ? '✓ Your Desired Size is Affordable' : '⚠ Your Desired Size Exceeds Budget'}
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Desired Building Size</div>
                                <div style="font-size: 1.5em; font-weight: 700; color: #2c3e50;">${formatNumber(buildingSize)} SF</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Estimated Affordable Size</div>
                                <div style="font-size: 1.5em; font-weight: 700; color: ${isAffordable ? '#28a745' : '#e57373'};">${formatNumber(avgAffordableSizeFinal, 0)} SF</div>
                                <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Based on adjusted avg ${formatCurrency(avgAffordableAdjustedPrice)}/SF</div>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background: rgba(255,255,255,0.7); border-radius: 6px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #2c3e50;">
                                ${isAffordable 
                                    ? `You can afford ${formatNumber(Math.abs(sizeDifference), 0)} SF MORE than your desired size (${Math.abs(sizePercentDiff).toFixed(1)}% extra capacity)`
                                    : `You need ${formatNumber(Math.abs(sizeDifference), 0)} SF LESS to stay within budget (${Math.abs(sizePercentDiff).toFixed(1)}% over budget)`
                                }
                            </div>
                            ${!isAffordable ? `
                                <div style="font-size: 0.9em; color: #555; margin-top: 10px;">
                                    <strong>Options to Make This Work:</strong><br>
                                    • <strong>Find a Building with Tenants:</strong> Rental income can bridge the ${formatCurrency(Math.abs(monthlySavings))} monthly gap<br>
                                    • <strong>Negotiate Through Your Broker:</strong> Target purchase price of ${formatCurrency(avgAffordableSizeFinal * avgPrice)} or less<br>
                                    • <strong>Increase Down Payment:</strong> Boost to ${Math.ceil((selectedPurchasePrice - (avgAffordableSizeFinal * avgPrice * (1 - downPaymentPct/100))) / selectedPurchasePrice * 100)}% to reduce monthly mortgage<br>
                                    • <strong>Consider Adjacent Submarkets:</strong> Nearby areas may offer better value while maintaining quality<br>
                                    • <strong>Right-Size the Space:</strong> ${formatNumber(avgAffordableSizeFinal, 0)} SF may be ideal for your needs<br>
                                    • <strong>Consider an Office Condo:</strong> Office condos typically have lower operating expenses, making your dollar go further
                                </div>
                            ` : isClose ? `
                                <div style="font-size: 0.9em; color: #555; margin-top: 10px;">
                                    <strong>Note:</strong> You're close to your maximum capacity. Consider maintaining some cushion for unexpected expenses or capital improvements.
                                </div>
                            ` : `
                                <div style="font-size: 0.9em; color: #555; margin-top: 10px;">
                                    <strong>💡 Strategic Opportunities With Your Extra Capacity:</strong><br>
                                    • <strong>Upgrade Building Quality:</strong> Target higher-end properties (${formatCurrency(adjustedQ3Price)}/SF) in your selected markets for premium quality<br>
                                    • <strong>Larger Space for Growth:</strong> Expand to ${formatNumber(avgAffordableSizeFinal, 0)} SF (${formatNumber(Math.abs(sizeDifference), 0)} SF more)<br>
                                    • <strong>Reduce Down Payment:</strong> Lower to 10% and preserve ${formatCurrency(selectedPurchasePrice * 0.05)} in working capital<br>
                                    • <strong>Premium Build-Out:</strong> Invest extra capacity in high-end finishes, technology, or amenities<br>
                                    • <strong>Income-Producing Property:</strong> Look for buildings with tenants to generate additional cash flow and accelerate your returns<br>
                                    • <strong>Future-Proof Investment:</strong> Buy for tomorrow's needs, not just today's
                                </div>
                            `}
                        </div>
                    </div>
                    
                    ${!isAffordable ? `
                        <div class="power-metric" style="background: linear-gradient(135deg, #e57373 0%, #ef5350 100%);">
                            <h4>Estimated Recommended Building Size</h4>
                            <div class="value">${formatNumber(maxBuildingSize, 0)} SF</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">
                                Purchase Price: ${formatCurrency(maxPurchasePrice)}<br>
                                Total Annual Cost: ${formatCurrency(maxTotalAnnualCost)}<br>
                                <span style="font-size: 0.95em; margin-top: 5px; display: block;">Based on size-adjusted lower-end pricing (${formatCurrency(maxAdjustedQ1Price)}/SF)</span>
                            </div>
                        </div>
                    ` : `
                        <div class="power-metric" style="background: linear-gradient(135deg, #28a745 0%, #218838 100%);">
                            <h4>Estimated Maximum Building You Could Afford</h4>
                            <div class="value">${formatNumber(maxBuildingSize, 0)} SF</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.9;">
                                Purchase Price: ${formatCurrency(maxPurchasePrice)}<br>
                                Total Annual Cost: ${formatCurrency(maxTotalAnnualCost)}<br>
                                <span style="font-size: 0.95em; margin-top: 5px; display: block;">Based on size-adjusted lower-end pricing (${formatCurrency(maxAdjustedQ1Price)}/SF)</span>
                            </div>
                        </div>
                    `}
                </div>
            `;

            // Market Data Timestamp
            resultsHTML += `
                <div style="text-align: center; margin: 40px 0 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <p style="color: #666; font-size: 0.9em; margin: 0;">
                        <strong>Market Data:</strong> Based on Atlanta metro sales data as of Q4 2025
                    </p>
                </div>
            `;

            // Next Steps Action Items
            resultsHTML += `
                <div style="margin: 40px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                    <h3 style="color: white; text-align: center; margin-bottom: 25px; font-size: 1.5em;">Ready to Take the Next Step?</h3>
                    <div class="action-buttons-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <a href="mailto:mparisi@industry-rep.com?subject=How should I handle my lease while looking for purchase options?" 
                           style="display: block; padding: 15px 25px; background: white; color: #667eea; text-align: center; border-radius: 8px; text-decoration: none; font-weight: 600; transition: transform 0.2s; font-size: 1em; border: none; cursor: pointer;"
                           onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'">
                            🤔 How should I handle my lease while looking for purchase options?
                        </a>
                        <a href="mailto:mparisi@industry-rep.com?subject=What lenders should I talk to?" 
                           style="display: block; padding: 15px 25px; background: white; color: #667eea; text-align: center; border-radius: 8px; text-decoration: none; font-weight: 600; transition: transform 0.2s; font-size: 1em; border: none; cursor: pointer;"
                           onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'">
                            💰 What lenders should I talk to?
                        </a>
                        <a href="mailto:mparisi@industry-rep.com?subject=What do purchase options look like today?" 
                           style="display: block; padding: 15px 25px; background: white; color: #667eea; text-align: center; border-radius: 8px; text-decoration: none; font-weight: 600; transition: transform 0.2s; font-size: 1em; border: none; cursor: pointer;"
                           onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'">
                            🏢 What do purchase options look like today?
                        </a>
                    </div>
                </div>
            `;

            document.getElementById('results').innerHTML = resultsHTML;
            
            // Update button text after first calculation
            if (!hasCalculated) {
                hasCalculated = true;
                const buttons = document.querySelectorAll('.calculate-btn');
                buttons.forEach(btn => {
                    btn.innerHTML = 'Re-calculate Analysis';
                });
            }
        }
    </script>
</body>
</html>
